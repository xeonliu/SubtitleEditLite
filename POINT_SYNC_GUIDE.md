# 点同步功能详细说明

## 功能概述

点同步（Point Sync via Another Subtitle）是一个强大的字幕时间同步工具，可以通过参考已有的正确字幕，精确调整当前字幕的时间轴。

## 使用场景

1. **多语言字幕同步**：有一份英文字幕时间正确，需要调整中文字幕时间
2. **版本同步**：有一份官方字幕，需要同步自己翻译的字幕
3. **帧率差异**：视频帧率变化导致字幕不同步
4. **非线性时间偏移**：字幕开头同步但越往后越不同步

## 操作流程

### 1. 打开主字幕
```
文件 > 打开 (Ctrl+O)
选择需要调整的SRT字幕文件
```

### 2. 启动点同步
```
编辑 > 点同步 (Ctrl+P)
```

### 3. 加载参考字幕
```
点击对话框右上角的"加载参考字幕..."按钮
选择时间正确的参考SRT文件
```

### 4. 添加同步点

#### 第一个同步点
1. 在左侧表格找到一个容易识别的字幕（如第一句台词）
2. 点击选中该行
3. 右侧表格会自动高亮时间相近的字幕：
   - **深蓝色** = 时间非常接近
   - **浅蓝色** = 时间较接近
   - **白色** = 时间差异较大
4. 在右侧找到对应的同步字幕，点击选中
5. 点击中间的"添加同步点 →"按钮

#### 添加更多同步点
- 重复上述步骤，在不同位置添加同步点
- **建议至少添加3个同步点**：
  - 开头部分（0-2分钟）
  - 中间部分（影片中段）
  - 结尾部分（最后几分钟）

### 5. 管理同步点

- **查看同步点**：中间列表显示所有已添加的同步点
- **定位同步点**：双击列表中的同步点，快速定位到对应行
- **删除同步点**：选中列表项，点击"移除选中"按钮

### 6. 应用预览

- 点击"应用预览 (Apply)"按钮
- 程序会根据所有同步点进行分段线性变换
- **左侧表格会立即更新显示同步后的时间**
- 此时仍在对话框内，可以继续调整

### 7. 调整和重试

- 查看左侧表格的同步效果
- 如果不满意，可以：
  - 添加或删除同步点
  - 再次点击"应用预览"查看新效果
  - 点击"重置 (Reset)"恢复到原始状态重新开始

### 8. 完成同步

- 确认效果满意后，点击"完成 (Finish)"按钮
- 返回主窗口，字幕已更新
- 使用 `Ctrl+S` 保存调整后的字幕
- 或点击"取消"放弃所有更改

## 核心算法：分段线性变换

### 算法原理

假设有 N 个同步点：P1, P2, ..., PN

对于任意字幕 S：
1. 找到 S 所在的区间：Pi ≤ S ≤ Pi+1
2. 计算 S 在原始时间轴的位置比例
3. 应用线性插值到参考时间轴
4. 保持字幕持续时长不变

### 数学公式

```
原始时间差: ΔT_old = Pi+1.time - Pi.time
参考时间差: ΔT_ref = Pi+1.ref_time - Pi.ref_time
时间缩放比: scale = ΔT_ref / ΔT_old

新时间 = Pi.ref_time + (S.time - Pi.time) × scale
```

### 优势

- **分段独立**：每段使用独立的缩放比例，适应非线性变化
- **精确插值**：区间内的字幕按比例精确调整
- **时长保持**：字幕显示时长保持不变
- **外推支持**：第一个点之前和最后一个点之后也能正确处理

## 实际示例

### 示例1：简单同步（2个点）

**场景**：开头同步，结尾慢了5秒

| 位置 | 左侧（当前）| 右侧（参考）|
|------|------------|------------|
| 点1  | 00:00:05   | 00:00:05   |
| 点2  | 00:30:00   | 00:29:55   |

**结果**：整体略微加快，开头不变，结尾同步

### 示例2：复杂同步（4个点）

**场景**：开头快，中间慢，结尾又快

| 位置 | 左侧（当前）| 右侧（参考）|
|------|------------|------------|
| 点1  | 00:01:00   | 00:00:58   |
| 点2  | 00:15:00   | 00:15:00   |
| 点3  | 00:30:00   | 00:30:05   |
| 点4  | 00:45:00   | 00:45:02   |

**结果**：
- 0-15分钟：略微加快
- 15-30分钟：略微减慢
- 30-45分钟：略微加快
- 每段独立调整，精确同步

## 智能高亮功能

### 颜色含义

当在左侧选中一行时，右侧会根据时间差异显示不同颜色：

- **深蓝色（透明度高）**：时间差 < 2秒，极可能是对应字幕
- **中蓝色（透明度中）**：时间差 2-5秒，可能是对应字幕
- **浅蓝色（透明度低）**：时间差 5-10秒，需要仔细确认
- **白色（无高亮）**：时间差 > 10秒，不太可能是对应字幕

### 使用技巧

1. **快速定位**：深蓝色的行通常就是要找的字幕
2. **内容确认**：颜色只是提示，最终需要对比文本内容
3. **滚动查看**：如果没有高亮，可能时间差异太大，需要手动查找

## 最佳实践

### ✅ 推荐做法

1. **多点胜于少点**：3-5个同步点效果最佳
2. **均匀分布**：同步点应覆盖整个时间轴
3. **特征明显**：选择台词独特、容易识别的字幕
4. **先测试**：完成后先检查几个关键位置是否同步
5. **保存备份**：应用前先"另存为"保留原始文件

### ❌ 避免事项

1. **点太少**：只用2个点处理长片段效果不佳
2. **点太密**：连续的行不需要都设为同步点
3. **错误对应**：确保左右两侧真的是对应的同一句话
4. **忽略验证**：应用后一定要检查几个位置

## 快捷键

| 操作 | 快捷键 |
|------|--------|
| 打开点同步 | Ctrl+P |
| 确认/应用 | Enter |
| 取消 | Esc |

## 故障排除

### 问题1：右侧没有高亮
**原因**：时间差异太大（超过10秒）
**解决**：手动查找对应字幕，或先用时间平移功能粗调

### 问题2：同步后时间变成负数
**原因**：同步点设置不合理，时间倒退
**解决**：检查同步点顺序，确保参考时间是递增的

### 问题3：某些字幕同步，某些不同步
**原因**：同步点数量不足或分布不均
**解决**：在不同步的区域增加同步点

### 问题4：无法添加同步点
**原因**：该源字幕已经有同步点了
**解决**：先移除旧的同步点，或选择其他行

## 技术限制

1. **时间差异范围**：建议原始字幕与参考字幕时间差不超过30秒
2. **同步点上限**：理论无限制，但通常不需要超过10个
3. **文件格式**：仅支持SRT格式
4. **编码**：仅支持UTF-8编码

## 总结

点同步功能是一个专业级的字幕同步工具，通过多点分段线性变换算法，可以精确处理各种复杂的时间不同步问题。合理使用同步点，配合智能高亮功能，能够快速高效地完成字幕时间调整工作。
