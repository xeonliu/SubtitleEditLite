# SRT字幕编辑器

一个基于Qt C++开发的简洁高效的SRT字幕编辑工具，支持字幕时间平移和点同步功能。

## 功能特性

### ✨ 核心功能

1. **打开和保存SRT文件**
   - 支持标准SRT格式的导入和导出
   - 自动解析时间戳和字幕文本
   - UTF-8/GBK编码支持（Windows 在缺少 ICU 时自动使用系统API解码 GBK/GB18030）

2. **字幕浏览和编辑**
   - 表格形式展示所有字幕
   - 显示序号、开始时间、结束时间和字幕文本
   - 可直接在表格中编辑时间和文本
   - 交替行颜色便于阅读

3. **时间平移 (Time Shift)**
   - 快捷键：`Ctrl+T`
   - 整体平移所有字幕的时间
   - 支持正负偏移（正数延迟，负数提前）
   - 以毫秒为单位精确调整

4. **点同步 (Point Sync via Another Subtitle)**
   - 快捷键：`Ctrl+P`
   - 类似Subtitle Edit的"Sync via other subtitle"功能
   - 通过加载参考字幕，选择多个同步点
   - 支持多点分段线性变换，精确同步
   - 智能时间近似度高亮显示

## 使用说明

### 基本操作

1. **打开字幕文件**
   - 点击 `文件 > 打开` 或按 `Ctrl+O`
   - 选择SRT格式的字幕文件

2. **保存修改**
   - 点击 `文件 > 保存` 或按 `Ctrl+S`
   - 保存到当前文件
   - 使用 `文件 > 另存为` 或 `Ctrl+Shift+S` 保存到新文件

3. **编辑字幕**
   - 双击表格单元格直接编辑
   - 时间格式：`HH:MM:SS,mmm`（例如：`00:01:23,456`）
   - 修改后会在窗口标题显示 `*` 标记

### 时间平移功能

当字幕整体偏快或偏慢时使用：

1. 点击 `编辑 > 时间平移` 或按 `Ctrl+T`
2. 输入时间偏移量（毫秒）
   - 正数：字幕向后延迟
   - 负数：字幕向前提前
   - 例如：输入 `1000` 表示所有字幕延迟1秒
3. 点击确定应用

### 点同步功能（通过参考字幕）

当有一个已经同步好的参考字幕，需要将当前字幕同步到相同时间时使用：

1. 点击 `编辑 > 点同步` 或按 `Ctrl+P`
2. 在对话框中，左侧显示当前字幕，右侧需要加载参考字幕
3. 点击"加载参考字幕..."按钮，选择一个SRT文件作为参考
4. 添加同步点：
   - 在左侧（当前字幕）选择一行
   - 右侧会根据时间远近自动高亮显示相近的字幕（深色=时间近，浅色=时间远）
   - 在右侧选择应该对应的参考字幕行
   - 点击"添加同步点 →"按钮
   - 重复以上步骤，添加多个同步点（建议至少2个）
5. 中间列表会显示所有添加的同步点
   - 双击同步点可以快速定位到对应行
   - 选中后点击"移除选中"可以删除
6. 点击"应用预览 (Apply)"按钮查看效果
   - 左侧表格立即更新显示同步后的时间
   - 可以继续调整同步点，再次应用预览
   - 点击"重置 (Reset)"可恢复原始状态
7. 确认满意后点击"完成 (Finish)"返回主窗口

**功能特点**：
- **多点支持**：可以添加任意多个同步点，实现分段线性变换
- **智能高亮**：选择左侧字幕时，右侧自动显示时间相近的字幕
- **精确同步**：每两个同步点之间独立进行线性插值，同步更精确
- **双表格视图**：左右对照，直观方便
- **实时预览**：应用后立即在左侧表格查看效果
- **可重复调整**：预览后可继续修改同步点
- **一键重置**：不满意随时恢复原始状态

**使用建议**：
- 至少添加2个同步点，越多越精确
- 建议在字幕开头、中间、结尾各选择一个同步点
- 同步点应均匀分布在整个字幕时间轴上

## 技术细节

### 项目结构

```
SubtitleEditApp/
├── main.cpp                  # 程序入口
├── mainwindow.h/cpp/ui       # 主窗口类
├── subtitle.h/cpp            # 字幕数据模型和SRT解析器
├── pointsyncdialog.h/cpp     # 点同步对话框
├── CMakeLists.txt            # CMake构建配置
├── test_sample.srt           # 测试样例文件（中文）
└── reference_sample.srt      # 参考字幕样例（英文）
```

### 构建项目

**要求**：
- Qt 6.x 或 Qt 5.x
- CMake 3.16+
- C++17编译器

**构建步骤**：

```bash
# 配置项目
cmake -B build -S . -DCMAKE_BUILD_TYPE=Debug

# 编译
cmake --build build

# 运行（macOS）
./build/SubtitleEditApp.app/Contents/MacOS/SubtitleEditApp

# 运行（Linux/Windows）
./build/SubtitleEditApp
```

### 核心类说明

**SubtitleItem**
- 字幕条目数据结构
- 包含序号、开始时间、结束时间、文本

**SRTParser**
- 静态工具类
- `parse()`: 解析SRT文件
- `save()`: 保存为SRT文件
- `shiftTime()`: 时间平移
- `pointSync()`: 点同步算法

**MainWindow**
- 主界面类
- 表格视图管理
- 用户交互处理

**PointSyncDialog**
- 点同步对话框类
- 双表格对照视图
- 智能时间近似度高亮
- 多点同步管理
- 分段线性变换算法

### 时间格式

SRT标准时间格式：`HH:MM:SS,mmm`
- HH: 小时（00-23）
- MM: 分钟（00-59）
- SS: 秒（00-59）
- mmm: 毫秒（000-999）

示例：`00:01:23,456` 表示 1分23秒456毫秒

## 快捷键

| 功能 | 快捷键 |
|------|--------|
| 打开文件 | `Ctrl+O` |
| 保存 | `Ctrl+S` |
| 另存为 | `Ctrl+Shift+S` |
| 退出 | `Ctrl+Q` |
| 时间平移 | `Ctrl+T` |
| 点同步 | `Ctrl+P` |

## 测试

项目包含两个测试样例文件：
- `test_sample.srt`: 中文字幕样例（作为当前字幕）
- `reference_sample.srt`: 英文字幕样例（作为参考字幕）

可以打开中文字幕，然后使用点同步功能加载英文字幕作为参考，测试多点同步功能。

## 许可证

本项目仅供学习和个人使用。

## 开发者

基于Qt 6框架开发，使用CMake构建系统。
